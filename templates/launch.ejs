<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Parent Page</title>
</head>

<body>
    <h1>Parent Page</h1>
    <iframe id="appIframe" src="about:blank" style="width: 100%; height: 600px;"></iframe>
    
    <script>
        function loadApp() {
            const iss = "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4";
            const iframeDoc = document.getElementById('appIframe').contentDocument || document.getElementById('appIframe').contentWindow.document;
            iframeDoc.open();
            iframeDoc.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8" />
                    <title>Launch My App</title>
                    <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
                </head>
                <body>
                    <script>
                        FHIR.oauth2.authorize({
                            clientId: "eec22f7e-5014-4b7c-98a1-178c505da56c",
                            scope: "launch/patient openid fhirUser patient/*.read Questionnaire.Read Questionnaire.Search QuestionnaireResponse.Read QuestionnaireResponse.Search Patient.Read Patient.Search Questionnaire.Create",
                            redirectUri: "https://smartonfhir.onrender.com/app",
                            iss: "${iss}",
                            aud: ""
                        });
                    <\/script>
                </body>
                </html>
            `);
            iframeDoc.close();
        }

        loadApp();
    </script>
</body>

</html>
